---
title: Create Refund
description: POST /api/v1/refunds — Create a new refund for a captured or settled transaction
---

## `POST /api/v1/refunds`

Creates a new refund. Requires `X-API-Key` header.

## Request headers

| Header | Required | Description |
|--------|----------|-------------|
| `X-API-Key` | **required** | API authentication key |
| `Idempotency-Key` | optional | Unique string (max 100 chars) to safely retry without double-processing |

## Request body

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `transaction_id` | string | **required** | ID of the transaction (`^[A-Z0-9_-]+$`, max 50 chars) |
| `operator_id` | string | **required** | ID of the operator initiating the refund (max 50 chars) |
| `reason` | string | **required** | Human-readable reason (max 500 chars) |
| `item_ids` | string[] | optional | Item IDs for a partial refund. Omit for full refund. Max 100 items. |

```json
{
  "transaction_id": "TXN-REG-001",
  "operator_id": "op1",
  "reason": "customer request"
}
```

## Response `201 Created`

Returned when the refund is created for the first time.

```json
{
  "data": {
    "refund_id": "RF-A1B2C3D4",
    "operation_type": "REFUND",
    "transaction_id": "TXN-REG-001",
    "status": "APPROVED",
    "total_refund_amount": "64.00",
    "currency": "USD",
    "operator_id": "op1",
    "reason": "customer request",
    "calculation_breakdown": {
      "scenario": "A: Full refund, single payment method",
      "total_refund": "64.00",
      "payment_breakdown": [
        {
          "payment_id": "PAY-REG-001",
          "payment_type": "CARD",
          "original_amount": "64.00",
          "refund_amount": "64.00",
          "currency": "USD"
        }
      ]
    },
    "created_at": "2026-02-25T10:00:00Z"
  },
  "meta": {
    "timestamp": "2026-02-25T10:00:00Z",
    "request_id": "550e8400-e29b-41d4-a716-446655440000"
  }
}
```

## Idempotent replay — `200 OK`

If the same `Idempotency-Key` is sent again, the server returns the original result without re-processing.
The response includes the header `Idempotent-Replayed: true` so callers can distinguish a replay from a new creation.

```bash
curl -X POST http://localhost:9000/api/v1/refunds \
  -H "X-API-Key: SOLARA-SECRET-2026" \
  -H "Content-Type: application/json" \
  -H "Idempotency-Key: refund-req-20260225-001" \
  -d '{
    "transaction_id": "TXN-REG-001",
    "operator_id": "op1",
    "reason": "customer request"
  }'
```

| Scenario | HTTP status | `Idempotent-Replayed` header |
|----------|-------------|------------------------------|
| First request | `201 Created` | absent |
| Retry with same key | `200 OK` | `true` |

## Error responses

| Code | HTTP | Condition |
|------|------|-----------|
| `TRANSACTION_NOT_FOUND` | 404 | Transaction does not exist |
| `INVALID_TRANSACTION_STATUS` | 422 | Status is not `CAPTURED` or `SETTLED` |
| `DUPLICATE_REFUND` | 409 | A full refund already exists for this transaction |
| `INVALID_ITEM_IDS` | 422 | One or more item IDs not found |
| `REFUND_AMOUNT_EXCEEDED` | 422 | Exceeds remaining refundable balance |
| `INSTALLMENT_NOT_CHARGED` | 422 | No installments charged yet |
| `UNAUTHORIZED` | 401 | Missing or invalid API key |
